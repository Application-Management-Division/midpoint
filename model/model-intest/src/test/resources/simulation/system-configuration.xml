<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!--
  ~ Copyright (c) 2020 Evolveum and contributors
  ~
  ~ This work is dual-licensed under the Apache License 2.0
  ~ and European Union Public License. See LICENSE file for details.
  -->

<systemConfiguration oid="00000000-0000-0000-0000-000000000001"
        xmlns="http://midpoint.evolveum.com/xml/ns/public/common/common-3"
        xmlns:q="http://prism.evolveum.com/xml/ns/public/query-3">
    <name>SystemConfiguration</name>
    <simulation>
        <metric>
            <identifier>modifications</identifier>
            <documentation>The number of non-operational item modifications. Applies to all kinds of objects.</documentation>
            <objectValue>
                <expression>
                    <script>
                        <code>processedObject.nonOperationalItemModificationsCount</code>
                    </script>
                </expression>
            </objectValue>
        </metric>
        <metric>
            <identifier>attribute-modifications</identifier>
            <objectValue>
                <expression>
                    <script>
                        <code>processedObject.attributeModificationsCount</code>
                    </script>
                </expression>
            </objectValue>
            <domain>
                <expression>
                    <script>
                        <code>processedObject.isShadow()</code>
                    </script>
                </expression>
            </domain>
        </metric>
        <metric>
            <identifier>association-values-changed</identifier>
            <objectValue>
                <expression>
                    <script>
                        <code>processedObject.associationValuesChanged</code>
                    </script>
                </expression>
            </objectValue>
            <domain>
                <expression>
                    <script>
                        <code>processedObject.isShadow()</code>
                    </script>
                </expression>
            </domain>
        </metric>
        <metric>
            <identifier>sum-modifications</identifier>
            <aggregation>
                <!-- Just for illustration purposes. Each object-level metric is summarized automatically. -->
                <aggregationFunction>domainTotalValue</aggregationFunction>
                <source>
                    <identifier>modifications</identifier>
                </source>
            </aggregation>
        </metric>
        <metric>
            <identifier>avg-focus-modifications</identifier>
            <aggregation>
                <aggregationFunction>domainTotalValueToDomainSize</aggregationFunction>
                <source>
                    <identifier>modifications</identifier>
                </source>
            </aggregation>
            <domain>
                <expression>
                    <script>
                        <!-- The original metric applies to all objects. Here we are interested in focal objects only. -->
                        <code>processedObject.isOfFocusType()</code>
                    </script>
                </expression>
            </domain>
        </metric>
        <metric>
            <identifier>pct-users-enabled</identifier>
            <aggregation>
                <aggregationFunction>domainTotalValueToDomainSize</aggregationFunction>
                <source>
                    <eventTagRef oid="00000000-0000-0000-0000-000000000710"/>
                </source>
            </aggregation>
            <domain>
                <filter>
                    <q:equal>
                        <q:path>type</q:path>
                        <q:value>c:UserType</q:value>
                    </q:equal>
                </filter>
            </domain>
        </metric>
        <metric>
            <identifier>pct-users-disabled</identifier>
            <aggregation>
                <aggregationFunction>domainTotalValueToDomainSize</aggregationFunction>
                <source>
                    <eventTagRef oid="00000000-0000-0000-0000-000000000711"/>
                </source>
            </aggregation>
            <domain>
                <filter>
                    <q:equal>
                        <q:path>type</q:path>
                        <q:value>c:UserType</q:value>
                    </q:equal>
                </filter>
            </domain>
        </metric>
        <!--<definition>-->
        <!--    <identifier>default-definition</identifier>-->
        <!--    <default>true</default>-->
        <!--    <metrics>-->

        <!--    </metrics>-->
        <!--</definition>-->
    </simulation>
</systemConfiguration>
